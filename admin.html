<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli - Ãœniversite Sistemi</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            background: #f4f4f9;
            color: #333;
            overflow: hidden;
        }

        /* SOL MENÃœ (SIDEBAR) */
        .sidebar {
            width: 250px;
            background: #2d3436;
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .sidebar h2 {
            margin-bottom: 30px;
            font-size: 1.4rem;
            text-align: center;
            border-bottom: 1px solid #555;
            padding-bottom: 15px;
        }

        .menu-item {
            padding: 15px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover,
        .active {
            background: #0984e3;
        }

        .logout-btn {
            margin-top: auto;
            background: #d63031;
            text-align: center;
            justify-content: center;
        }

        /* SAÄ Ä°Ã‡ERÄ°K (CONTENT) */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 1.8rem;
            color: #2d3436;
        }

        /* TABLOLAR Ä°Ã‡Ä°N STÄ°L */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #0984e3;
            color: white;
        }

        tr:hover {
            background: #f1f2f6;
        }

        /* Action ButonlarÄ± */
        .btn-edit {
            background: #f1c40f;
            color: #333;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-delete {
            background: #d63031;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Ekleme Butonu */
        .btn-add {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add:hover {
            background: #219150;
        }

        /* --- EDIT MODAL STÄ°LLERÄ° --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #555;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .btn-save {
            width: 100%;
            background: #27ae60;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-save:hover {
            background: #219150;
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <h2>Admin Paneli</h2>
        <div class="menu-item active" onclick="showSection('users')">ğŸ‘¤ KullanÄ±cÄ±lar</div>
        <div class="menu-item" onclick="showSection('projects')">ğŸš€ Projeler</div>
        <div class="menu-item" onclick="showSection('departments')">ğŸ›ï¸ BÃ¶lÃ¼mler</div>
        <div class="menu-item" onclick="showSection('courses')">ğŸ“š Dersler</div>
        <div class="menu-item logout-btn" onclick="logout()">ğŸšª Ã‡Ä±kÄ±ÅŸ Yap</div>
    </div>

    <div class="content">
        <div class="header">
            <h1 id="pageTitle">KullanÄ±cÄ± YÃ¶netimi</h1>
            <div id="adminName" style="font-weight: bold; color: #0984e3;">Admin</div>
        </div>

        <div id="tableContainer">
            <p>YÃ¼kleniyor...</p>
        </div>
    </div>

    <div id="adminModal" class="modal-overlay">
        <div class="modal-box">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="margin-bottom:20px;">KaydÄ± DÃ¼zenle</h2>

            <div id="modalFormContent">
            </div>

            <button class="btn-save" onclick="saveChanges()">ğŸ’¾ DeÄŸiÅŸiklikleri Kaydet</button>
        </div>
    </div>

    <div>
        <button class="btn-add" onclick="openAddModal()" style="margin-top: 100px;">+ Yeni KayÄ±t Ekle</button>
    </div>

    <script>
        const API_URL = "http://localhost:3000";

        // Global DeÄŸiÅŸkenler
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        let currentData = [];    // Tablodaki verileri burada tutacaÄŸÄ±z
        let currentType = "";    // Åu an neyi gÃ¶rÃ¼ntÃ¼lÃ¼yoruz? (users, departments vb.)
        let editingId = null;    // Åu an hangi ID'yi dÃ¼zenliyoruz?

        // 1. Yetki KontrolÃ¼
        if (!currentUser || currentUser.RoleID !== 1) {
            alert("Bu sayfaya eriÅŸim yetkiniz yok!");
            window.location.href = "index.html";
        } else {
            document.getElementById("adminName").innerText = currentUser.FullName;
            loadData('users'); // VarsayÄ±lan aÃ§Ä±lÄ±ÅŸ
        }

        /* --- VERÄ° YÃ–NETÄ°MÄ° --- */
        function showSection(section) {
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            loadData(section);
        }

        async function loadData(type) {
            currentType = type; // Hangi bÃ¶lÃ¼mde olduÄŸumuzu kaydet
            const container = document.getElementById("tableContainer");
            const title = document.getElementById("pageTitle");
            container.innerHTML = "<p>Veriler yÃ¼kleniyor...</p>";

            let endpoint = "";
            let columns = [];
            let headers = [];

            // BÃ¶lÃ¼me gÃ¶re ayarlar
            if (type === 'users') {
                title.innerText = "KullanÄ±cÄ± YÃ¶netimi";
                endpoint = "/users";
                // BURAYA DepartmentName EKLENDÄ°
                columns = ["UserID", "FullName", "Email", "DepartmentName", "RoleID"];
                headers = ["ID", "Ä°sim Soyisim", "E-posta", "BÃ¶lÃ¼m", "Rol"];
            } else if (type === 'departments') {
                title.innerText = "BÃ¶lÃ¼m YÃ¶netimi";
                endpoint = "/departments";
                columns = ["DepartmentID", "DepartmentName"];
                headers = ["ID", "BÃ¶lÃ¼m AdÄ±"];
            } else if (type === 'courses') {
                title.innerText = "Ders YÃ¶netimi";
                endpoint = "/courses";
                columns = ["CourseID", "CourseCode", "CourseName", "Term"];
                headers = ["ID", "Kod", "Ders AdÄ±", "DÃ¶nem"];
            } else if (type === 'projects') {
                title.innerText = "Proje YÃ¶netimi";
                endpoint = "/projects";
                columns = ["ProjectID", "Title", "Status", "StudentName"];
                headers = ["ID", "BaÅŸlÄ±k", "Durum", "Ã–ÄŸrenci"];
            }

            try {
                const res = await fetch(API_URL + endpoint);
                currentData = await res.json(); // ğŸ”¥ Veriyi hafÄ±zaya al

                if (currentData.length === 0) {
                    container.innerHTML = "<p>KayÄ±t bulunamadÄ±.</p>"; return;
                }

                // Tabloyu Ã‡iz
                let html = `<table><thead><tr>`;
                headers.forEach(h => html += `<th>${h}</th>`);
                html += `<th>Ä°ÅŸlemler</th></tr></thead><tbody>`;

                currentData.forEach(item => {
                    html += `<tr>`;
                    columns.forEach(col => {
                        // RoleID gÃ¶rselleÅŸtirme
                        let val = item[col];
                        if (col === 'RoleID') {
                            if (val === 1) val = '<span style="color:red;font-weight:bold">Admin</span>';
                            if (val === 2) val = '<span style="color:blue">Ã–ÄŸretmen</span>';
                            if (val === 3) val = '<span style="color:green">Ã–ÄŸrenci</span>';
                        }
                        html += `<td>${val || '-'}</td>`;
                    });

                    // Ä°lk sÃ¼tun her zaman ID'dir varsayÄ±mÄ±yla:
                    const idValue = item[columns[0]];

                    html += `
                <td>
                    <button class="btn-edit" onclick="openEditModal(${idValue})">DÃ¼zenle</button>
                    <button class="btn-delete" onclick="deleteItem(${idValue})">Sil</button>
                </td>
            </tr>`;
                });
                html += `</tbody></table>`;
                container.innerHTML = html;

            } catch (err) {
                container.innerHTML = "Hata: " + err.message;
            }
        }
        // 1. EKLEME MODALINI AÃ‡ (Form BoÅŸ Gelir)
        function openAddModal() {
            editingId = null; // ID'yi sÄ±fÄ±rla ki sistem yeni kayÄ±t olduÄŸunu anlasÄ±n
            const formDiv = document.getElementById("modalFormContent");
            document.getElementById("modalTitle").innerText = "Yeni KayÄ±t Ekle";

            let formHTML = "";

            if (currentType === 'users') {
                formHTML = `
            <div class="form-group"><label>Ä°sim Soyisim</label><input type="text" id="inpName" placeholder="Ad Soyad"></div>
            <div class="form-group"><label>E-posta</label><input type="text" id="inpEmail" placeholder="ornek@uni.edu"></div>
            <div class="form-group"><label>Åifre</label><input type="text" id="inpPass" value="1234"></div>
            <div class="form-group"><label>BÃ¶lÃ¼m ID (Sadece Hoca/Ã–ÄŸrenci Ä°Ã§in)</label><input type="number" id="inpDeptID" placeholder="Ã–rn: 1"></div>
            
            <div class="form-group"><label>Rol</label>
                <select id="inpRole">
                    <option value="2">Ã–ÄŸretmen</option>
                    <option value="3">Ã–ÄŸrenci</option>
                    <option value="1">Admin</option>
                </select>
            </div>
        `;
            } else if (currentType === 'departments') {
                formHTML = `
            <div class="form-group"><label>BÃ¶lÃ¼m AdÄ±</label><input type="text" id="inpDeptName" placeholder="Bilgisayar MÃ¼h."></div>
        `;
            } else if (currentType === 'courses') {
                formHTML = `
            <div class="form-group"><label>Ders Kodu</label><input type="text" id="inpCode" placeholder="CSE101"></div>
            <div class="form-group"><label>Ders AdÄ±</label><input type="text" id="inpCourseName" placeholder="Algoritma"></div>
            <div class="form-group"><label>DÃ¶nem</label><input type="text" id="inpTerm" placeholder="2025 GÃ¼z"></div>
            
            <div class="form-group">
                <label>BaÄŸlÄ± OlduÄŸu BÃ¶lÃ¼m</label>
                <select id="inpCourseDept" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <option value="">BÃ¶lÃ¼mler YÃ¼kleniyor...</option>
                </select>
            </div>

            <div class="form-group">
                <label>Dersi Verecek Hoca (DanÄ±ÅŸman)</label>
                <select id="inpInstructor" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <option value="">MÃ¼sait hocalar aranÄ±yor...</option>
                </select>
                <p id="noTeacherWarning" style="color:red; font-size:0.8rem; display:none;">âš ï¸ BoÅŸta akademisyen bulunamadÄ±!</p>
            </div>
        `;

                // Ä°ki veriyi de doldurmamÄ±z lazÄ±m (BÃ¶lÃ¼mler ve Hocalar)
                setTimeout(() => {
                    fillDepartmentsToSelect();
                    fillAvailableInstructors(); // Birazdan yazacaÄŸÄ±z
                }, 100);
            } else if (currentType === 'projects') {
                formHTML = `
            <div class="form-group"><label>Proje BaÅŸlÄ±ÄŸÄ±</label><input type="text" id="inpTitle"></div>
            <div class="form-group"><label>Ã–zet</label><input type="text" id="inpSummary"></div>
            <p style="font-size:0.8rem; color:red;">Not: Admin panelinden eklenen projeler varsayÄ±lan ID'lere atanÄ±r.</p>
        `;
            }

            formDiv.innerHTML = formHTML;
            document.getElementById("adminModal").style.display = "flex";
        }
        /* --- DÃœZENLEME (MODAL) MANTIÄI --- */
        function openEditModal(id) {
            editingId = id;
            document.getElementById("modalTitle").innerText = "KaydÄ± DÃ¼zenle";
            const item = currentData.find(x => Object.values(x)[0] === id); // HafÄ±zadan bul
            const formDiv = document.getElementById("modalFormContent");

            // Formu Temizle ve TÃ¼rÃ¼ne GÃ¶re Doldur
            let formHTML = "";

            if (currentType === 'users') {
                formHTML = `
            <div class="form-group"><label>Ä°sim Soyisim</label><input type="text" id="inpName" value="${item.FullName}"></div>
            <div class="form-group"><label>E-posta</label><input type="text" id="inpEmail" value="${item.Email}"></div>
            
            <div class="form-group">
                <label>BÃ¶lÃ¼m</label>
                <select id="inpDeptID" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <option value="">YÃ¼kleniyor...</option>
                </select>
            </div>

            <div class="form-group"><label>Rol (1:Admin, 2:Hoca, 3:Ã–ÄŸr)</label>
                <select id="inpRole">
                    <option value="1" ${item.RoleID === 1 ? 'selected' : ''}>Admin</option>
                    <option value="2" ${item.RoleID === 2 ? 'selected' : ''}>Ã–ÄŸretmen</option>
                    <option value="3" ${item.RoleID === 3 ? 'selected' : ''}>Ã–ÄŸrenci</option>
                </select>
            </div>
        `;

                // BÃ¶lÃ¼mleri Ã§ek ve kullanÄ±cÄ±nÄ±n mevcut bÃ¶lÃ¼mÃ¼nÃ¼ seÃ§ili hale getir
                setTimeout(() => {
                    fillUserDeptForEdit(item.DepartmentID);
                }, 100);
            } else if (currentType === 'departments') {
                formHTML = `
            <div class="form-group"><label>BÃ¶lÃ¼m AdÄ±</label><input type="text" id="inpDeptName" value="${item.DepartmentName}"></div>
        `;
                /* admin.html - openEditModal iÃ§inde 'courses' bloÄŸunu deÄŸiÅŸtir */

            } else if (currentType === 'courses') {
                formHTML = `
            <div class="form-group"><label>Ders Kodu</label><input type="text" id="inpCode" value="${item.CourseCode}"></div>
            <div class="form-group"><label>Ders AdÄ±</label><input type="text" id="inpCourseName" value="${item.CourseName}"></div>
            <div class="form-group"><label>DÃ¶nem</label><input type="text" id="inpTerm" value="${item.Term}"></div>
            
            <div class="form-group">
                <label>BaÄŸlÄ± OlduÄŸu BÃ¶lÃ¼m</label>
                <select id="inpCourseDept" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <option value="">YÃ¼kleniyor...</option>
                </select>
            </div>

            <div class="form-group">
                <label>Dersi Verecek Hoca</label>
                <select id="inpInstructor" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <option value="">YÃ¼kleniyor...</option>
                </select>
            </div>
        `;

                // Verileri doldur ve mevcut seÃ§imleri yap (item.DepartmentID ve item.InstructorID veritabanÄ±ndan geliyor)
                setTimeout(() => {
                    fillDropdownsForEdit(item.DepartmentID, item.InstructorID);
                }, 100);
            } else if (currentType === 'projects') {
                formHTML = `
        <div class="form-group">
            <label>Proje BaÅŸlÄ±ÄŸÄ±</label>
            <input type="text" id="inpTitle" value="${item.Title}">
        </div>
        <div class="form-group">
            <label>Durum</label>
            <select id="inpStatus">
                <option value="proposal" ${item.Status === 'proposal' ? 'selected' : ''}>ğŸ”µ Ã–neri</option>
                <option value="development" ${item.Status === 'development' ? 'selected' : ''}>ğŸŸ¡ GeliÅŸtiriliyor</option>
                <option value="submitted" ${item.Status === 'submitted' ? 'selected' : ''}>ğŸŸ£ Teslim Edildi</option>
                <option value="approved" ${item.Status === 'approved' ? 'selected' : ''}>ğŸŸ¢ OnaylandÄ±</option>
                <option value="rejected" ${item.Status === 'rejected' ? 'selected' : ''}>ğŸ”´ Reddedildi</option>
            </select>
        </div>
        <div class="form-group">
            <label>Ã–zet (Summary)</label>
            <textarea id="inpSummary" rows="4" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px;">${item.Summary || ''}</textarea>
        </div>
    `;
            }

            formDiv.innerHTML = formHTML;
            document.getElementById("adminModal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("adminModal").style.display = "none";
        }

        async function saveChanges() {
            let bodyData = {};
            let endpoint = "";
            let method = "POST"; // VarsayÄ±lan: EKLEME

            // Hangi verileri alacaÄŸÄ±mÄ±zÄ± belirle
            if (currentType === 'users') {
                bodyData = {
                    FullName: document.getElementById("inpName").value,
                    Email: document.getElementById("inpEmail").value,
                    RoleID: parseInt(document.getElementById("inpRole").value),
                    // YENÄ° SATIR: BÃ¶lÃ¼m ID'sini al
                    DepartmentID: document.getElementById("inpDeptID").value || null

                };
                // ... (ÅŸifre kÄ±smÄ± aynÄ± kalacak)
                // EÄŸer Ekleme modundaysak Åifreyi de al
                if (editingId === null) {
                    bodyData.Password = document.getElementById("inpPass").value;
                }
            } else if (currentType === 'departments') {
                bodyData = { DepartmentName: document.getElementById("inpDeptName").value };
            } else if (currentType === 'courses') {
                bodyData = {
                    CourseCode: document.getElementById("inpCode").value,
                    CourseName: document.getElementById("inpCourseName").value,
                    Term: document.getElementById("inpTerm").value,
                    // YENÄ° EKLENEN SATIR: SeÃ§ilen BÃ¶lÃ¼m ID'sini alÄ±yoruz
                    DepartmentID: document.getElementById("inpCourseDept").value || null,
                    InstructorID: document.getElementById("inpInstructor").value || null
                };
            } else if (currentType === 'projects') {
                // Hem Ekleme Hem GÃ¼ncelleme iÃ§in verileri hazÄ±rla
                bodyData = {
                    Title: document.getElementById("inpTitle").value,
                    Summary: document.getElementById("inpSummary").value,
                    // EÄŸer input varsa (DÃ¼zenle modunda) deÄŸerini al, yoksa (Ekle modunda) varsayÄ±lan 'proposal' olsun
                    Status: document.getElementById("inpStatus") ? document.getElementById("inpStatus").value : 'proposal'
                };
                // Backend update endpoint'i kÃ¼Ã§Ã¼k harfle bekliyordu (req.body.title vs.), uyumlu olsun:
                if (editingId !== null) {
                    bodyData.title = bodyData.Title;
                    bodyData.status = bodyData.Status;
                    bodyData.summary = bodyData.Summary;
                }
            }

            // KARAR ANI: Ekleme mi GÃ¼ncelleme mi?
            if (editingId !== null) {
                // ID varsa bu bir GÃœNCELLEMEDÄ°R
                method = "PUT";
                endpoint = `/${currentType}/${editingId}`;
            } else {
                // ID yoksa bu bir EKLEMEDÄ°R
                method = "POST";
                endpoint = `/${currentType}`;
            }

            if (!confirm("Ä°ÅŸlemi onaylÄ±yor musunuz?")) return;

            try {
                const res = await fetch(API_URL + endpoint, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bodyData)
                });
                const result = await res.json();

                if (result.success) {
                    alert(editingId ? "âœ… GÃ¼ncellendi" : "âœ… Yeni KayÄ±t Eklendi");
                    closeModal();
                    loadData(currentType); // Tabloyu yenile
                } else {
                    alert("Hata: " + result.message);
                }
            } catch (err) {
                alert("Sunucu hatasÄ±: " + err);
            }
        }

        /* --- SÄ°LME MANTIÄI (GÃœNCELLENMÄ°Å) --- */
        async function deleteItem(id) {
            if (!confirm("Bu kaydÄ± kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz?")) return;

            let endpoint = "";

            // Hangi sayfadaysak ona uygun endpoint belirliyoruz
            if (currentType === 'projects') {
                endpoint = `/projects/${id}`;
            } else if (currentType === 'users') {
                endpoint = `/users/${id}`;
            } else if (currentType === 'departments') {
                endpoint = `/departments/${id}`;
            } else if (currentType === 'courses') {
                endpoint = `/courses/${id}`;
            }

            // EÄŸer endpoint hala boÅŸsa hata ver
            if (!endpoint) {
                alert("Bu veri tÃ¼rÃ¼ iÃ§in silme iÅŸlemi henÃ¼z aktif deÄŸil.");
                return;
            }

            try {
                const res = await fetch(API_URL + endpoint, { method: 'DELETE' });
                const result = await res.json();

                if (result.success) {
                    alert("âœ… BaÅŸarÄ±yla silindi.");
                    loadData(currentType); // Tabloyu yenile
                } else {
                    // Backend'den gelen SQL hatasÄ±nÄ± (Foreign Key uyarÄ±sÄ±nÄ±) gÃ¶sterir
                    alert("Hata: " + result.message);
                }
            } catch (e) {
                alert("Sunucu hatasÄ± oluÅŸtu.");
            }
        }

        function logout() {
            localStorage.removeItem("currentUser");
            window.location.href = "index.html";
        }

        async function fillDepartmentsToSelect() {
            const selectBox = document.getElementById("inpCourseDept");
            if (!selectBox) return; // EÄŸer kutu yoksa iÅŸlem yapma

            try {
                const res = await fetch(`${API_URL}/departments`);
                const depts = await res.json();

                let options = '<option value="">BÃ¶lÃ¼m SeÃ§iniz...</option>';
                depts.forEach(d => {
                    options += `<option value="${d.DepartmentID}">${d.DepartmentName}</option>`;
                });
                selectBox.innerHTML = options;
            } catch (e) {
                selectBox.innerHTML = '<option value="">Hata oluÅŸtu</option>';
            }
        }

        /* admin.html - Script etiketinin iÃ§ine ekle */

        async function fillAvailableInstructors() {
            const selectBox = document.getElementById("inpInstructor");
            const warningText = document.getElementById("noTeacherWarning");

            if (!selectBox) return;

            try {
                const res = await fetch(`${API_URL}/available-instructors`);
                const teachers = await res.json();

                // EÄŸer liste boÅŸsa uyarÄ± ver
                if (teachers.length === 0) {
                    selectBox.innerHTML = '<option value="">-- MÃ¼sait Hoca Yok --</option>';
                    selectBox.disabled = true; // SeÃ§imi kilitle
                    warningText.style.display = "block"; // KÄ±rmÄ±zÄ± uyarÄ±yÄ± gÃ¶ster
                } else {
                    let options = '<option value="">Bir Hoca SeÃ§iniz...</option>';
                    teachers.forEach(t => {
                        options += `<option value="${t.UserID}">${t.FullName}</option>`;
                    });
                    selectBox.innerHTML = options;
                    selectBox.disabled = false;
                    warningText.style.display = "none";
                }
            } catch (e) {
                selectBox.innerHTML = '<option value="">Hata oluÅŸtu</option>';
            }
        }

        async function fillDropdownsForEdit(currentDeptID, currentInstID) {
            const deptSelect = document.getElementById("inpCourseDept");
            const instSelect = document.getElementById("inpInstructor");

            // 1. BÃ–LÃœMLERÄ° DOLDUR
            try {
                const resD = await fetch(`${API_URL}/departments`);
                const depts = await resD.json();
                let dOptions = '<option value="">BÃ¶lÃ¼m SeÃ§iniz...</option>';
                depts.forEach(d => {
                    // EÄŸer veritabanÄ±ndaki ID ile dÃ¶ngÃ¼deki ID eÅŸleÅŸirse 'selected' ekle
                    const isSelected = (d.DepartmentID === currentDeptID) ? 'selected' : '';
                    dOptions += `<option value="${d.DepartmentID}" ${isSelected}>${d.DepartmentName}</option>`;
                });
                deptSelect.innerHTML = dOptions;
            } catch (e) { console.log(e); }

            // 2. HOCALARI DOLDUR (TÃ¼m Ã¶ÄŸretmenleri getiriyoruz ki mevcut hoca da listede olsun)
            try {
                const resU = await fetch(`${API_URL}/users`);
                const users = await resU.json();

                // Sadece RoleID = 2 (Ã–ÄŸretmen) olanlarÄ± filtrele
                const teachers = users.filter(u => u.RoleID === 2);

                let tOptions = '<option value="">Hoca SeÃ§iniz...</option>';
                teachers.forEach(t => {
                    const isSelected = (t.UserID === currentInstID) ? 'selected' : '';
                    tOptions += `<option value="${t.UserID}" ${isSelected}>${t.FullName}</option>`;
                });
                instSelect.innerHTML = tOptions;
            } catch (e) { console.log(e); }
        }

        async function fillUserDeptForEdit(currentUserDeptID) {
            const selectBox = document.getElementById("inpDeptID");
            if (!selectBox) return;

            try {
                const res = await fetch(`${API_URL}/departments`);
                const depts = await res.json();

                let options = '<option value="">-- BÃ¶lÃ¼m Yok / SeÃ§ilmedi --</option>';

                depts.forEach(d => {
                    // EÄŸer veritabanÄ±ndaki ID ile kullanÄ±cÄ±nÄ±n ID'si eÅŸleÅŸirse 'selected' ekle
                    const isSelected = (d.DepartmentID === currentUserDeptID) ? 'selected' : '';
                    options += `<option value="${d.DepartmentID}" ${isSelected}>${d.DepartmentName}</option>`;
                });

                selectBox.innerHTML = options;
            } catch (e) {
                selectBox.innerHTML = '<option value="">Hata oluÅŸtu</option>';
            }
        }

    </script>
</body>

</html>